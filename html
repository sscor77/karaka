<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Corrector de Tono en Web</title>
</head>
<body>
  <h1>Corrector de Tono en Tiempo Real</h1>
  <button id="start">Comenzar</button>
  <button id="stop" disabled>Detener</button>
  <script src="https://cdn.jsdelivr.net/npm/pitch-shift@latest/dist/pitch-shift.min.js"></script>
  <script>
    const startButton = document.getElementById('start');
    const stopButton = document.getElementById('stop');
    let audioContext, source, pitchShifter;

    // Función para iniciar el corrector de tono
    startButton.addEventListener('click', async () => {
      try {
        // Solicitar acceso al micrófono
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

        // Crear el contexto de audio
        audioContext = new AudioContext();

        // Crear una fuente de audio desde el micrófono
        source = audioContext.createMediaStreamSource(stream);

        // Crear un nodo de cambio de tono (pitch shifter)
        pitchShifter = new PitchShift(audioContext);
        pitchShifter.pitch = 1.0; // Ajustar el tono (1.0 = sin cambios)

        // Conectar la fuente al pitch shifter y este a la salida
        source.connect(pitchShifter);
        pitchShifter.connect(audioContext.destination);

        // Habilitar/deshabilitar botones
        startButton.disabled = true;
        stopButton.disabled = false;
      } catch (error) {
        console.error('Error al acceder al micrófono:', error);
      }
    });

    // Función para detener el corrector de tono
    stopButton.addEventListener('click', () => {
      if (audioContext) {
        audioContext.close(); // Cerrar el contexto de audio
        startButton.disabled = false;
        stopButton.disabled = true;
      }
    });
  </script>
</body>
</html>
